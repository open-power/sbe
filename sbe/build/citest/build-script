#!/bin/sh

if [ -z $WORKSPACE ]; then
    export WORKSPACE=`pwd`
fi

if [ -z $SBEROOT ]; then
    source "$WORKSPACE/env.bash"
fi

source "$SBEROOT/sbe/build/citest/setup-env"

# @TODO via RTC 140875
#Enable it once SBE copyright script is ready
# Check copyright.
#check-copyright > copyright.log 2>&1 &
#COPYRIGHT_PID=$!


# Build .
cd sbe/image
scl enable devtoolset-2 " bash -c  \"make install\"" || exit -1
cd -

# Create simics sandbox.
create-sandbox > create-sandbox.log 2>&1 &
CREATESANDBOX_PID=$!

# Check sandbox create completion.
wait $CREATESANDBOX_PID
if [ $? -eq 0 ]; then
    cat create-sandbox.log
else
    echo "----Sandbox creation failed."
    cat create-sandbox.log
    exit -1
fi

# Add SBE files to simics sandbox.
populate-sandbox || exit -1

sbetest-start.sh || exit -1

# @TODO via RTC 140875
#Enable it once SBE copyright script is ready
# Check copyright completion.
#wait $COPYRIGHT_PID
#if [ $? -eq 0 ]; then
#    cat copyright.log
#else
#    echo "----Copyright check failed."
#    cat copyright.log
#    exit -1
#fi

